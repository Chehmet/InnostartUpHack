<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Тепловая карта перекрестка</title>
<style>
  /* Стили для контейнера перекрестка */
  body {
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column; /* Добавляем вертикальное выравнивание по центру */
    height: 100vh;
    overflow: scroll;
  }

  h1 {
    margin-top: 20px; /* Отступ сверху для заголовка */
  }

  .intersection {
    position: relative;
    width: 700px;
    height: 700px;
    background-image: url('cross_good_q.jpg'); /* Изображение перекрестка */
    background-size: cover;
    border: 2px solid #ccc;
    overflow: hidden; /* Ограничиваем область видимости для таблицы */
  }

  /* Стили для квадрата таблицы */
  .square {
    width: calc(100% / 20);
    height: calc(100% / 20);
    float: left;
    transition: background-color 0.3s ease; /* Плавное изменение цвета квадрата */
  }
</style>
</head>
<body>
  <h1>Тепловая карта перекрестка</h1> <!-- Заголовок теперь сверху -->
  <div class="intersection" id="intersection">
    <!-- Тепловые точки будут добавлены сюда с помощью JavaScript -->
  </div>

  <script>
    const socket = new WebSocket('ws://localhost:8766');

    // Обработчик события при открытии соединения
    socket.onopen = function(event) {
        console.log('WebSocket connected');
    };

    // Обработчик события при получении сообщения
    socket.onmessage = function(event) {
        console.log('Received message:', event.data);
        // Здесь вы можете обработать полученные данные и отобразить их на веб-странице
        const data = JSON.parse(event.data);
        updateHeatMap(data);
    };

    // Обработчик события при закрытии соединения
    socket.onclose = function(event) {
        console.log('WebSocket disconnected');
    };

    // Функция для обновления тепловой карты на основе данных с бэкенда
    function updateHeatMap(data) {
      const fieldData = data.field; // Access the 'field' property of the data

      const intersection = document.getElementById('intersection');

      // Clear previous content
      intersection.innerHTML = '';

      // Create new heatmap
      for (let i = 0; i < fieldData.length; i++) {
        for (let j = 0; j < fieldData[i].length; j++) {
          const value = fieldData[i][j];
          const square = document.createElement('div');
          square.classList.add('square');
          square.style.backgroundColor = getColor(value);
          intersection.appendChild(square);
        }
      }
    }

    // Function to determine color based on value
    // Function to determine color based on value
    function getColor(value) {
      if (value === 0) {
          return 'transparent'; // Make the cell transparent if value is 0
      } else {
          // Normalize the value to the range [0, 1]
          const normalizedValue = Math.min(1, value / 45000);

          // Interpolate between blue and red based on the normalized value
          const r = Math.round(255 * normalizedValue); // Red component
          const b = Math.round(255 * (1 - normalizedValue)); // Blue component

          // Return the RGB color string
          return `rgb(${r}, 0, ${b})`;
      }
  }




  </script>
</body>
</html>
