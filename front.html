<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Тепловая карта перекрестка</title>
<style>
  /* Стили для контейнера перекрестка */
  body {
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column; /* Добавляем вертикальное выравнивание по центру */
    height: 100vh;
  }

  h1 {
    margin-top: 20px; /* Отступ сверху для заголовка */
  }

  .intersection {
    position: relative;
    width: 700px;
    height: 700px;
    background-image: url('cross_good_q.jpg'); /* Изображение перекрестка */
    background-size: cover;
    border: 2px solid #ccc;
    overflow: hidden; /* Ограничиваем область видимости для таблицы */
  }

  /* Стили для квадрата таблицы */
  .square {
    width: calc(100% / 20);
    height: calc(100% / 20);
    float: left;
    transition: background-color 0.3s ease; /* Плавное изменение цвета квадрата */
  }
</style>
</head>
<body>
  <h1>Тепловая карта перекрестка</h1> <!-- Заголовок теперь сверху -->
  <div class="intersection" id="intersection">
    <!-- Тепловые точки будут добавлены сюда с помощью JavaScript -->
  </div>

  <script>
    const socket = new WebSocket('ws://hack.invian.ru:9094/aboba');

    // Обработчик события при открытии соединения
    socket.onopen = function(event) {
        console.log('WebSocket connected');
    };

    // Обработчик события при получении сообщения
    socket.onmessage = function(event) {
        console.log('Received message:', event.data);
        // Здесь вы можете обработать полученные данные и отобразить их на веб-странице
        const data = JSON.parse(event.data);
        updateHeatMap(data);
    };

    // Обработчик события при закрытии соединения
    socket.onclose = function(event) {
        console.log('WebSocket disconnected');
    };

    // Функция для обновления тепловой карты на основе данных с бэкенда
    function updateHeatMap(data) {
      const intersection = document.getElementById('intersection');

      // Удаляем старую таблицу, если она существует
      while (intersection.firstChild) {
        intersection.removeChild(intersection.firstChild);
      }

      // Создаем новую таблицу 20x20
      for (let i = 0; i < 20; i++) {
        for (let j = 0; j < 20; j++) {
          const square = document.createElement('div');
          square.classList.add('square');
          const value = data[i][j];
          square.style.backgroundColor = getColor(value); // Устанавливаем цвет в зависимости от значения
          intersection.appendChild(square);
        }
      }
    }

    // Функция для определения цвета квадрата в зависимости от значения
    function getColor(value) {
      // Преобразуем значение к диапазону от 0 до 255
      const normalizedValue = Math.floor((value / 10000) * 255);
      // Устанавливаем красный цвет в зависимости от нормализованного значения
      return `rgb(${normalizedValue}, 0, 0)`;
    }
  </script>
</body>
</html>
