<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Тепловая карта перекрестка</title>
<style>
  /* Стили для контейнера перекрестка */
  body {
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column; /* Добавляем вертикальное выравнивание по центру */
    height: 100vh;
  }

  h1 {
    margin-top: 20px; /* Отступ сверху для заголовка */
  }

  .intersection {
    position: relative;
    width: 700px;
    height: 700px;
    background-image: url('cross_good_q.jpg'); /* Изображение перекрестка */
    background-size: cover;
    border: 2px solid #ccc;
  }

  /* Стили для тепловых точек */
  .heat-point {
    position: absolute;
    width: 20px;
    height: 20px;
    background-color: red;
    border-radius: 50%;
    transform: translate(-50%, -50%);
    transition: all 1s ease; /* Плавное изменение размера тепловых точек */
  }

  /* Стили для графиков */
  .chart-container {
    display: flex;
    justify-content: space-around;
    margin-top: 20px;
  }

  .chart {
    width: 150px;
    height: 150px;
    border: 1px solid #ccc;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px;
    border-radius: 10px;
  }

  .chart h3 {
    margin: 5px 0;
  }
</style>
</head>
<body>
  <h1>Тепловая карта перекрестка</h1> <!-- Заголовок теперь сверху -->
  <div class="intersection" id="intersection">
    <!-- Тепловые точки будут добавлены сюда с помощью JavaScript -->
  </div>

  <div class="chart-container">
    <div class="chart" id="motorcycle-chart">
      <h3>Мотоциклы</h3>
      <div class="count">0</div>
    </div>
    <div class="chart" id="car-chart">
      <h3>Легковой автомобиль</h3>
      <div class="count">0</div>
    </div>
    <div class="chart" id="car-trailer-chart">
      <h3>Легковой автомобиль с прицепом</h3>
      <div class="count">0</div>
    </div>
    <div class="chart" id="truck-chart">
      <h3>Грузовой автомобиль</h3>
      <div class="count">0</div>
    </div>
    <div class="chart" id="road-train-chart">
      <h3>Автопоезд</h3>
      <div class="count">0</div>
    </div>
    <div class="chart" id="bus-chart">
      <h3>Автобус</h3>
      <div class="count">0</div>
    </div>
  </div>

  <script>
    const socket = new WebSocket('ws://hack.invian.ru:9094/aboba');

    // Обработчик события при открытии соединения
    socket.onopen = function(event) {
        console.log('WebSocket connected');
    };

    // Обработчик события при получении сообщения
    socket.onmessage = function(event) {
        console.log('Received message:', event.data);
        // Здесь вы можете обработать полученные данные и отобразить их на веб-странице
        const data = JSON.parse(event.data);
        updateHeatMap(data);
        updateCharts(data);
    };

    // Обработчик события при закрытии соединения
    socket.onclose = function(event) {
        console.log('WebSocket disconnected');
    };

    // Функция для обновления тепловых точек на основе данных с бэкенда
    function updateHeatMap(data) {
      const intersection = document.getElementById('intersection');

      // Удаляем старые тепловые точки
      const oldHeatPoints = document.querySelectorAll('.heat-point');
      oldHeatPoints.forEach(point => point.remove());

      // Создаем новые тепловые точки
      data.forEach(item => {
        const [x, y] = item.center;
        const heatPoint = document.createElement('div');
        heatPoint.classList.add('heat-point');
        heatPoint.style.left = `${x}px`;
        heatPoint.style.top = `${y}px`;
        heatPoint.style.width = heatPoint.style.height = `${item.class * 5}px`; // Размер зависит от значения class

        intersection.appendChild(heatPoint);
      });
    }

    // Функция для обновления графиков по каждому виду транспорта
    function updateCharts(data) {
      const charts = {
        motorcycle: document.getElementById('motorcycle-chart').querySelector('.count'),
        car: document.getElementById('car-chart').querySelector('.count'),
        carTrailer: document.getElementById('car-trailer-chart').querySelector('.count'),
        truck: document.getElementById('truck-chart').querySelector('.count'),
        roadTrain: document.getElementById('road-train-chart').querySelector('.count'),
        bus: document.getElementById('bus-chart').querySelector('.count')
      };

      // Обнуляем счетчики для каждого графика
      Object.values(charts).forEach(chart => chart.textContent = 0);

      // Подсчитываем количество транспорта и обновляем соответствующие графики
      data.forEach(item => {
        switch(item.class) {
          case 0:
            charts.motorcycle.textContent = parseInt(charts.motorcycle.textContent) + 1;
            break;
          case 1:
            charts.car.textContent = parseInt(charts.car.textContent) + 1;
            break;
          case 2:
            charts.carTrailer.textContent = parseInt(charts.carTrailer.textContent) + 1;
            break;
          case 3:
            charts.truck.textContent = parseInt(charts.truck.textContent) + 1;
            break;
          case 4:
            charts.roadTrain.textContent = parseInt(charts.roadTrain.textContent) + 1;
            break;
          case 5:
            charts.bus.textContent = parseInt(charts.bus.textContent) + 1;
            break;
          default:
            break;
        }
      });
    }
  </script>
</body>
</html>
